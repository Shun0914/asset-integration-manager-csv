# CSV形式ガイド

## 標準CSV形式

Asset Integration Managerでは、以下のカラムを持つCSV形式を標準としています：

```
銘柄コード,銘柄名,市場区分,セクター,保有数量,取得単価,現在価格,評価額,損益,損益率,通貨,取得日,配当利回り
```

### カラム詳細

| カラム名 | データ型 | 必須 | 説明 |
|---------|---------|:----:|------|
| 銘柄コード | 文字列 | ✓ | 証券コード（例: 7203） |
| 銘柄名 | 文字列 | ✓ | 銘柄の名称（例: トヨタ自動車） |
| 市場区分 | 文字列 |  | 上場市場区分（例: 東証プライム） |
| セクター | 文字列 |  | 業種セクター（例: 自動車・輸送機） |
| 保有数量 | 数値 | ✓ | 保有株数または口数 |
| 取得単価 | 数値 | ✓ | 1株あたりの取得価格 |
| 現在価格 | 数値 | ✓ | 現在の1株あたり価格 |
| 評価額 | 数値 |  | 現在の評価総額（保有数量×現在価格） |
| 損益 | 数値 |  | 評価額 - (取得単価×保有数量) |
| 損益率 | 数値 |  | 損益÷(取得単価×保有数量)×100（%） |
| 通貨 | 文字列 |  | 通貨コード（例: JPY, USD） |
| 取得日 | 日付 |  | 株式取得日（YYYY-MM-DD形式） |
| 配当利回り | 数値 |  | 年間配当利回り（%） |

### データ形式の注意点

- **数値**: カンマなし、小数点はピリオド（.）を使用
- **日付**: YYYY-MM-DD形式を推奨（例: 2023-01-15）
- **損益率**: パーセント値で、単位記号（%）なし
- **セクター**: 日本の証券取引所の33業種分類に準拠

## 対応証券会社CSVフォーマット

Asset Integration Managerは以下の証券会社が出力するCSV形式にも対応しています：

### 松井証券

```
銘柄コード,銘柄名,保有数,取得単価,現在値,損益,評価額
```

### 楽天証券

```
銘柄コード,銘柄名,市場,保有株数,平均取得単価（円）,現在値（円）,評価額（円）,評価損益（円）,評価損益率（％）
```

### SBI証券

```
銘柄コード,銘柄,数量,平均取得単価,現在値,評価額,損益,損益率,売買区分
```

## CSV作成ガイドライン

独自にCSVを作成する場合は、以下のガイドラインに従ってください：

1. **ヘッダー行**: 1行目にはカラム名を記載
2. **文字コード**: UTF-8を推奨（Shift-JISも対応）
3. **区切り文字**: カンマ（,）
4. **必須項目**: 銘柄コード、銘柄名、保有数量、取得単価、現在価格は必須
5. **数値フォーマット**: 数値はカンマ区切りなし、小数点はピリオド

## サンプルCSV

標準形式のサンプルCSVは以下の場所にあります：

```
asset_integration_manager/samples/sample_portfolio.csv
```

このファイルは、アプリケーションのテストやデモにも使用できます。

## カスタムフォーマット対応

アプリケーションは、以下の手順でカスタムCSVフォーマットにも対応可能です：

1. CSVファイルをアップロード
2. ヘッダーを標準フォーマットにマッピング
3. マッピング設定を保存（次回以降自動適用）

## データ変換と補完

CSVにデータが不足している場合、以下の補完処理が行われます：

1. **評価額**: 保有数量×現在価格で自動計算
2. **損益**: 評価額-(保有数量×取得単価)で自動計算
3. **損益率**: 損益÷(保有数量×取得単価)×100で自動計算
4. **市場区分・セクター**: 銘柄コードから自動補完（将来実装予定）
5. **配当利回り**: 銘柄コードから自動補完（将来実装予定）

## よくあるエラーと解決策

| エラー | 考えられる原因 | 解決策 |
|--------|--------------|--------|
| パース失敗 | 文字コードの問題 | UTF-8またはShift-JISで保存し直す |
| 数値変換エラー | カンマ区切りの数値 | 数値からカンマを削除する |
| 日付形式エラー | サポートされていない日付形式 | YYYY-MM-DD形式に変更 |
| 必須項目なし | 必要なカラムが存在しない | 必須カラムを追加するか、マッピングを修正 |
